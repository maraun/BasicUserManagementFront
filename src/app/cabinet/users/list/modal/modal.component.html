<div class="steppers-container row">
  <div class="col-sm-12 col-md-12">
    <nb-card>
      <nb-card-header>
        <div *ngIf="userExist; else newUser">Edit {{ user.profile.firstname }}'s info</div>
        <ng-template #newUser>Create new user</ng-template>
      </nb-card-header>
      <nb-card-body>
        <nb-stepper #stepper>
          <nb-step [stepControl]="firstForm" label="Account info">
            <form [formGroup]="firstForm" (ngSubmit)="onFirstSubmit()" class="step-container">
              <div class="form-group row">
                <label for="iin" class="label col-sm-3 col-form-label">IIN</label>
                <div class="col-sm-9">
                  <input nbInput fullWidth type="text" placeholder="Enter IIN" id="iin" class="form-control"
                         formControlName="iin" [minlength]="12" [maxlength]="12" required
                         [ngClass]="{'form-control-danger': firstForm.controls.iin.invalid && firstForm.controls.iin.touched}">
                  <span class="error-message" *ngIf="(firstForm.controls.iin.errors?.required || firstForm.controls.iin.errors?.minlength) && firstForm.controls.iin.touched">
                    IIN is required!
                  </span>
                </div>
              </div>
              <div class="form-group row">
                <label for="password" class="label col-sm-3 col-form-label">Password</label>
                <div class="col-sm-9">
                  <input nbInput fullWidth type="password" placeholder="Enter password" id="password"
                         class="form-control"
                         formControlName="password"
                         [ngClass]="{'form-control-': firstForm.invalid && firstForm.touched}">
                </div>
              </div>
              <hr>
              <div class="form-group row">
                <label for="lastname" class="label col-sm-3 col-form-label">Lastname</label>
                <div class="col-sm-9">
                  <input nbInput fullWidth type="text" placeholder="Enter lastname" id="lastname" class="form-control"
                         formControlName="lastname" required
                         [ngClass]="{'form-control-danger': firstForm.controls.lastname.invalid && firstForm.controls.lastname.touched}">
                </div>
              </div>
              <div class="form-group row">
                <label for="firstname" class="label col-sm-3 col-form-label">Firstame</label>
                <div class="col-sm-9">
                  <input nbInput fullWidth type="text" placeholder="Enter name" id="firstname" class="form-control"
                         formControlName="firstname" required
                         [ngClass]="{'form-control-danger': firstForm.controls.firstname.invalid && firstForm.controls.firstname.touched}">
                </div>
              </div>
              <div class="form-group row">
                <label for="middlename" class="label col-sm-3 col-form-label">Middlename</label>
                <div class="col-sm-9">
                  <input nbInput fullWidth type="text" placeholder="Enter middlename" id="middlename"
                         class="form-control"
                         formControlName="middlename">
                </div>
              </div>
              <div class="form-group row">
                <label for="previousLastname" class="label col-sm-3 col-form-label">Previous Lastname</label>
                <div class="col-sm-9">
                  <input nbInput fullWidth type="text" placeholder="Enter previousLastname" id="previousLastname"
                         class="form-control"
                         formControlName="previousLastname">
                </div>
              </div>
              <hr>
              <div class="form-group row">
                <label for="birthDate" class="label col-sm-3 col-form-label">Birth Date</label>
                <div class="col-sm-9">
                  <input nbInput fullWidth
                         placeholder="Enter birth date" formControlName="birthDate" id="birthDate"
                         [nbDatepicker]="formpicker" required
                         [ngClass]="{'form-control-danger': firstForm.controls.birthDate.invalid && firstForm.controls.birthDate.touched}">
                  <nb-datepicker #formpicker></nb-datepicker>
                </div>
              </div>
              <div class="form-group row">
                <label for="previousLastname" class="label col-sm-3 col-form-label">Gender</label>
                <div class="col-sm-9">
                  <nb-select fullWidth placeholder="Enter gender" id="gender" formControlName="gender">
                    <nb-option *ngFor="let gender of genders"
                               [value]="gender.id">{{gender.name}}</nb-option>
                  </nb-select>
                </div>
              </div>
              <div class="form-group row">
                <label for="maritalStatus" class="label col-sm-3 col-form-label">Marital Status</label>
                <div class="col-sm-9">
                  <nb-select fullWidth placeholder="Enter marital status" id="maritalStatus"
                             formControlName="maritalStatus">
                    <nb-option *ngFor="let maritalStatus of maritalStatuses"
                               [value]="maritalStatus.id">{{maritalStatus.name}}</nb-option>
                  </nb-select>
                </div>
              </div>
              <button nbButton nbStepperNext [disabled]="!firstForm.valid">next</button>
            </form>
          </nb-step>
          <nb-step [stepControl]="secondForm" label="Contacts info">
            <form [formGroup]="secondForm" (ngSubmit)="onSecondSubmit()" class="step-container">
              <div class="form-group row">
                <label for="nationality" class="label col-sm-3 col-form-label">Nationality</label>
                <div class="col-sm-9">
                  <nb-select fullWidth placeholder="Enter nationality" id="nationality" formControlName="nationality"
                  required>
                    <nb-option *ngFor="let nationality of nationalities"
                               [value]="nationality.id">{{nationality.name}}</nb-option>
                  </nb-select>
                </div>
              </div>
              <div class="form-group row">
                <label for="citizenship" class="label col-sm-3 col-form-label">Citizenship</label>
                <div class="col-sm-9">
                  <nb-select fullWidth placeholder="Enter citizenship" id="citizenship" formControlName="citizenship">
                    <nb-option *ngFor="let citizenship of citizenships"
                               [value]="citizenship.id">{{citizenship.name}}</nb-option>
                  </nb-select>
                </div>
              </div>
              <div class="form-group row">
                <label for="livingPlace" class="label col-sm-3 col-form-label">Living place</label>
                <div class="col-sm-9">
                  <input nbInput fullWidth type="text" placeholder="Enter living place" id="livingPlace"
                         class="form-control"
                         formControlName="livingPlace">
                </div>
              </div>
              <div class="form-group row">
                <label for="registrationPlace" class="label col-sm-3 col-form-label">Registration place</label>
                <div class="col-sm-9">
                  <input nbInput fullWidth type="text" placeholder="Enter registration place" id="registrationPlace"
                         class="form-control"
                         formControlName="registrationPlace">
                </div>
              </div>
              <hr>
              <div class="form-group row">
                <label for="email" class="label col-sm-3 col-form-label">e-mail</label>
                <div class="col-sm-9">
                  <input nbInput fullWidth type="email" placeholder="Enter email" id="email" class="form-control"
                         formControlName="email" required email pattern="[a-zA-Z_]+@[a-zA-Z_]+?\.[a-zA-Z]{2,6}"
                         [ngClass]="{'form-control-danger': secondForm.controls.email.invalid && secondForm.controls.email.touched}">
                </div>
              </div>
              <div class="form-group row">
                <label for="mobilePhone" class="label col-sm-3 col-form-label">Mobile phone</label>
                <div class="col-sm-9">
                  <input nbInput fullWidth type="text" placeholder="Enter mobile phone" id="mobilePhone"
                         class="form-control" required pattern="[0-9]{11}"
                         formControlName="mobilePhone"
                         [ngClass]="{'form-control-danger': secondForm.controls.mobilePhone.invalid && secondForm.controls.mobilePhone.touched}">
                </div>
              </div>
              <div class="form-group row">
                <label for="workPhone" class="label col-sm-3 col-form-label">Work phone</label>
                <div class="col-sm-9">
                  <input nbInput fullWidth type="text" placeholder="Enter work phone" id="workPhone"
                         class="form-control"
                         formControlName="workPhone" pattern="[0-9]{11}">
                </div>
              </div>
              <div class="form-group row">
                <label for="homePhone" class="label col-sm-3 col-form-label">Home phone</label>
                <div class="col-sm-9">
                  <input nbInput fullWidth type="text" placeholder="Enter home phone" id="homePhone"
                         class="form-control"
                         formControlName="homePhone">
                </div>
              </div>
              <button nbButton nbStepperPrevious>prev</button>
              <button nbButton nbStepperNext [disabled]="!secondForm.valid">next</button>
            </form>
          </nb-step>
          <nb-step [stepControl]="thirdForm" label="Additional info">
            <form [formGroup]="thirdForm" (ngSubmit)="onThirdSubmit()" class="step-container">
              <div class="form-group row">
                <label for="additional" class="label col-sm-3 col-form-label">Additional information</label>
                <div class="col-sm-9">
                  <textarea fullWidth type="text" placeholder="Enter additional information" id="additional"
                            class="form-control"
                            formControlName="additional"
                            [ngClass]="{'form-control-danger': secondForm.invalid && (secondForm.dirty || secondForm.touched)}"></textarea>
                </div>
                <button (click)="addPosition()">Add</button>

                <div formArrayName="positions" *ngFor="let pos of thirdForm.controls.positions?.value; let i = index">
                  <ng-container [formGroupName]="i">
                    <input placeholder="Username" [value]="pos.id" formControlName="id">
                    <input placeholder="Password" [value]="pos.position" formControlName="position">
                  </ng-container>
                </div>
              </div>
              <button nbButton nbStepperPrevious>prev</button>
              <button nbButton nbStepperNext>Confirm</button>
            </form>
          </nb-step>
        </nb-stepper>
      </nb-card-body>
      <nb-card-footer>
        <div class="buttons-row">
          <button nbButton hero status="danger" (click)="dismiss()">Close</button>
        </div>
      </nb-card-footer>
    </nb-card>
  </div>
</div>
